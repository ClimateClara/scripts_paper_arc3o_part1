\hypertarget{namespacemo__functions}{
\section{mo\_\-functions Module Reference}
\label{namespacemo__functions}\index{mo\_\-functions@{mo\_\-functions}}
}


Module houses functions which have no home :(.  


\subsection*{Functions/Subroutines}
\begin{DoxyCompactItemize}
\item 
REAL(wp) \hyperlink{namespacemo__functions_a1799a36a0ad153bc87957b7e87ad9b3c}{func\_\-density} (T, S)
\begin{DoxyCompactList}\small\item\em Calculates the physical density for given S and T. \item\end{DoxyCompactList}\item 
REAL(wp) \hyperlink{namespacemo__functions_a3f4e5c13d71b23efaa040a3d14e55f64}{func\_\-freeboard} (N\_\-active, Nlayer, psi\_\-s, psi\_\-g, m, thick, m\_\-snow)
\begin{DoxyCompactList}\small\item\em Calculates the freeboard of the 1d ice column. \item\end{DoxyCompactList}\item 
REAL(wp) \hyperlink{namespacemo__functions_ac51bdce087ab161f25d6ad11a28e655c}{func\_\-albedo} (thick\_\-snow, T\_\-snow, psi\_\-l, thick\_\-min, albedo\_\-flag)
\begin{DoxyCompactList}\small\item\em Calculates the albedo. \item\end{DoxyCompactList}\item 
REAL(wp) \hyperlink{namespacemo__functions_a2983289475e56c950511d8b6e37b1064}{func\_\-sat\_\-O2} (T, S\_\-bu)
\begin{DoxyCompactList}\small\item\em Calculates the oxygen saturation as a function of salinity and temperature. \item\end{DoxyCompactList}\item 
REAL(wp) \hyperlink{namespacemo__functions_a9413c611dfaf39e6cf8441a766b5df8b}{func\_\-T\_\-freeze} (S\_\-bu, salt\_\-flag)
\begin{DoxyCompactList}\small\item\em Calculates the freezing temperature. Salt\_\-flag determines if either ocean salt or NAcl is used. \item\end{DoxyCompactList}\item 
subroutine \hyperlink{namespacemo__functions_a3c7420d9fae7442aeb1407179e971c35}{sub\_\-notzflux} (time, fl\_\-sw, fl\_\-rest)
\begin{DoxyCompactList}\small\item\em Calculates the incoming shortwave and other fluxes according to p. 193-\/194 PhD Notz. \item\end{DoxyCompactList}\item 
subroutine \hyperlink{namespacemo__functions_afbb9a7012e709e4b2b6f402a9831159e}{sub\_\-input} (length\_\-input, fl\_\-sw\_\-input, fl\_\-lw\_\-input, T2m\_\-input, precip\_\-input, time\_\-input)
\begin{DoxyCompactList}\small\item\em Reads in data for atmoflux\_\-flag ==2. \item\end{DoxyCompactList}\item 
subroutine \hyperlink{namespacemo__functions_aea674291e55cedde9a5ec71e45e92dc8}{sub\_\-turb\_\-flux} (T\_\-bottom, S\_\-bu\_\-bottom, T, S\_\-abs, m, dt, N\_\-bgc, bgc\_\-bottom, bgc\_\-abs)
\begin{DoxyCompactList}\small\item\em Calculates salt and tracer mixing between lowest layer and underlying water. \item\end{DoxyCompactList}\item 
subroutine \hyperlink{namespacemo__functions_a463f28035b07b28bba73b8a1100b848a}{sub\_\-melt\_\-thick} (psi\_\-l, psi\_\-s, psi\_\-g, T, T\_\-freeze, T\_\-top, fl\_\-Q, thick\_\-snow, dt, melt\_\-thick, thick, thick\_\-min)
\begin{DoxyCompactList}\small\item\em Calculates the thickness of the meltwater film. \item\end{DoxyCompactList}\item 
subroutine \hyperlink{namespacemo__functions_ad19818302426c2848ed285986cf1430d}{sub\_\-melt\_\-snow} (melt\_\-thick, thick, thick\_\-snow, H\_\-abs, H\_\-abs\_\-snow, m, m\_\-snow, psi\_\-g\_\-snow)
\begin{DoxyCompactList}\small\item\em Calculates how the meltwater film interacts with snow. \item\end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Module houses functions which have no home :(. Created because I wanted to calculate the freeboard separately and didn't know where to put it.

\begin{DoxyParagraph}{Revision History}
Ribbon cut by Philipp Griewank 2011-\/01-\/07 
\end{DoxyParagraph}


\subsection{Function/Subroutine Documentation}
\hypertarget{namespacemo__functions_ac51bdce087ab161f25d6ad11a28e655c}{
\index{mo\_\-functions@{mo\_\-functions}!func\_\-albedo@{func\_\-albedo}}
\index{func\_\-albedo@{func\_\-albedo}!mo_functions@{mo\_\-functions}}
\subsubsection[{func\_\-albedo}]{\setlength{\rightskip}{0pt plus 5cm}REAL(wp) mo\_\-functions::func\_\-albedo (
\begin{DoxyParamCaption}
\item[{REAL(wp),intent(in)}]{ thick\_\-snow, }
\item[{REAL(wp),intent(in)}]{ T\_\-snow, }
\item[{REAL(wp),intent(in)}]{ psi\_\-l, }
\item[{REAL(wp),intent(in)}]{ thick\_\-min, }
\item[{INTEGER,intent(in)}]{ albedo\_\-flag}
\end{DoxyParamCaption}
)}}
\label{namespacemo__functions_ac51bdce087ab161f25d6ad11a28e655c}


Calculates the albedo. 

Calculates the albedo according to top conditions. This is not a good albedo scheme! It is only a quick approach. Non-\/continuous switching between wet and dry ice. Linear change from wet ice to water. Linear change from ice\_\-dry snow for snow thinner than 30cm.

psi\_\-l(1)$>$ 0.75 water psi\_\-l(1)$>$ 0.6 linear change from wet ice to water psi\_\-l(1)$>$ 0.2 wet ice psi\_\-l(1)$<$ 0.2 -\/$>$ dry ice T\_\-snow = 0 -\/$>$ wet snow T\_\-snow $<$ 0 -\/$>$ dry snow

\begin{DoxyParagraph}{Revision History}
Built to spill by Philipp Griewank (2011-\/02-\/12) 
\end{DoxyParagraph}
\hypertarget{namespacemo__functions_a1799a36a0ad153bc87957b7e87ad9b3c}{
\index{mo\_\-functions@{mo\_\-functions}!func\_\-density@{func\_\-density}}
\index{func\_\-density@{func\_\-density}!mo_functions@{mo\_\-functions}}
\subsubsection[{func\_\-density}]{\setlength{\rightskip}{0pt plus 5cm}REAL(wp) mo\_\-functions::func\_\-density (
\begin{DoxyParamCaption}
\item[{REAL(wp),intent(in)}]{ T, }
\item[{REAL(wp),intent(in)}]{ S}
\end{DoxyParamCaption}
)}}
\label{namespacemo__functions_a1799a36a0ad153bc87957b7e87ad9b3c}


Calculates the physical density for given S and T. 

Although the model treats Salinity as a massless tracer, sometimes it is necessary to determine the exact density for specific purposes. First implemented to calculate simple turbulence between liquid layer and ocean. Uses following simplification of Frank J. Millero and Alain Poisson 1981: Density = density\_\-0 +A$\ast$S+B$\ast$S$\ast$$\ast$1.5

\begin{DoxyParagraph}{Revision History}
Started by Philipp Griewank (2011-\/02-\/24) 
\end{DoxyParagraph}
\hypertarget{namespacemo__functions_a3f4e5c13d71b23efaa040a3d14e55f64}{
\index{mo\_\-functions@{mo\_\-functions}!func\_\-freeboard@{func\_\-freeboard}}
\index{func\_\-freeboard@{func\_\-freeboard}!mo_functions@{mo\_\-functions}}
\subsubsection[{func\_\-freeboard}]{\setlength{\rightskip}{0pt plus 5cm}REAL(wp) mo\_\-functions::func\_\-freeboard (
\begin{DoxyParamCaption}
\item[{INTEGER,intent(in)}]{ N\_\-active, }
\item[{INTEGER,intent(in)}]{ Nlayer, }
\item[{REAL(wp),dimension(nlayer),intent(in)}]{ psi\_\-s, }
\item[{REAL(wp),dimension(nlayer),intent(in)}]{ psi\_\-g, }
\item[{REAL(wp),dimension(nlayer),intent(in)}]{ m, }
\item[{REAL(wp),dimension(nlayer),intent(in)}]{ thick, }
\item[{REAL(wp),intent(in)}]{ m\_\-snow}
\end{DoxyParamCaption}
)}}
\label{namespacemo__functions_a3f4e5c13d71b23efaa040a3d14e55f64}


Calculates the freeboard of the 1d ice column. 

The freeboard is calculated by first finding out which layer is at water level, and then finding out how deep the layer is submerged. For the correct freeboard the mass above water equals the buoyancy of the submerged part. Since the density of each layer is constant, step two can be calculated explicitly. The freeboard is the distance from the top of the ice to the water level. If snow pushes the ice underwater the freeboard becomes negative

\begin{DoxyParagraph}{Revision History}
Built to spill by Philipp Griewank (2011-\/01-\/07) Negative freeboard included by Philipp Griewank (2011-\/01-\/09) Patched bug by Philipp Griewank (2011-\/03-\/10) 
\end{DoxyParagraph}
\hypertarget{namespacemo__functions_a2983289475e56c950511d8b6e37b1064}{
\index{mo\_\-functions@{mo\_\-functions}!func\_\-sat\_\-O2@{func\_\-sat\_\-O2}}
\index{func\_\-sat\_\-O2@{func\_\-sat\_\-O2}!mo_functions@{mo\_\-functions}}
\subsubsection[{func\_\-sat\_\-O2}]{\setlength{\rightskip}{0pt plus 5cm}REAL(wp) mo\_\-functions::func\_\-sat\_\-O2 (
\begin{DoxyParamCaption}
\item[{REAL(wp),intent(in)}]{ T, }
\item[{REAL(wp),intent(in)}]{ S\_\-bu}
\end{DoxyParamCaption}
)}}
\label{namespacemo__functions_a2983289475e56c950511d8b6e37b1064}


Calculates the oxygen saturation as a function of salinity and temperature. 

Calculates the concentration of oxygen dissolved in freshwater and seawater in equilibrium with the atmosphere The value should be umol/kg. I switched to the solubility of nitrogen, oxygen and argon in water and sea wate from Weiss R.F. 1970 because I couldn't get the other one to work out \begin{DoxyParagraph}{Revision History}
Written by Dr. Philipp Griewank (2014-\/02-\/25) 
\end{DoxyParagraph}
\hypertarget{namespacemo__functions_a9413c611dfaf39e6cf8441a766b5df8b}{
\index{mo\_\-functions@{mo\_\-functions}!func\_\-T\_\-freeze@{func\_\-T\_\-freeze}}
\index{func\_\-T\_\-freeze@{func\_\-T\_\-freeze}!mo_functions@{mo\_\-functions}}
\subsubsection[{func\_\-T\_\-freeze}]{\setlength{\rightskip}{0pt plus 5cm}REAL(wp) mo\_\-functions::func\_\-T\_\-freeze (
\begin{DoxyParamCaption}
\item[{REAL(wp),intent(in)}]{ S\_\-bu, }
\item[{INTEGER,intent(in)}]{ salt\_\-flag}
\end{DoxyParamCaption}
)}}
\label{namespacemo__functions_a9413c611dfaf39e6cf8441a766b5df8b}


Calculates the freezing temperature. Salt\_\-flag determines if either ocean salt or NAcl is used. 

\begin{DoxyParagraph}{Revision History}
Written to procrastinate by Philipp Griewank (2011-\/05-\/05) 
\end{DoxyParagraph}
\hypertarget{namespacemo__functions_afbb9a7012e709e4b2b6f402a9831159e}{
\index{mo\_\-functions@{mo\_\-functions}!sub\_\-input@{sub\_\-input}}
\index{sub\_\-input@{sub\_\-input}!mo_functions@{mo\_\-functions}}
\subsubsection[{sub\_\-input}]{\setlength{\rightskip}{0pt plus 5cm}subroutine mo\_\-functions::sub\_\-input (
\begin{DoxyParamCaption}
\item[{INTEGER,intent(in)}]{ length\_\-input, }
\item[{REAL(wp),dimension(:),intent(out),allocatable}]{ fl\_\-sw\_\-input, }
\item[{REAL(wp),dimension(:),intent(out),allocatable}]{ fl\_\-lw\_\-input, }
\item[{REAL(wp),dimension(:),intent(out),allocatable}]{ T2m\_\-input, }
\item[{REAL(wp),dimension(:),intent(out),allocatable}]{ precip\_\-input, }
\item[{REAL(wp),dimension(:),intent(out),allocatable}]{ time\_\-input}
\end{DoxyParamCaption}
)}}
\label{namespacemo__functions_afbb9a7012e709e4b2b6f402a9831159e}


Reads in data for atmoflux\_\-flag ==2. 

Standard setup used for testcase 4 and all Griewank \& Notz 2013/14 reanalysis forced runs is 4.5 years of three hourly values of shortwave incoming, longwave incoming, two meter T, and total precipitation. Data is read from ascii files and stored in long 1D arrays. ERA-\/interim derived input files in the standard length for various Arctic locations are located under /input/ERA/ Latent and sensible heat fluxes are not included, but could be added if needed.

\begin{DoxyParagraph}{Revision History}
Moved here from \hyperlink{namespacemo__grotz}{mo\_\-grotz} by Philipp Griewank (2014-\/04-\/20) 
\end{DoxyParagraph}
\hypertarget{namespacemo__functions_ad19818302426c2848ed285986cf1430d}{
\index{mo\_\-functions@{mo\_\-functions}!sub\_\-melt\_\-snow@{sub\_\-melt\_\-snow}}
\index{sub\_\-melt\_\-snow@{sub\_\-melt\_\-snow}!mo_functions@{mo\_\-functions}}
\subsubsection[{sub\_\-melt\_\-snow}]{\setlength{\rightskip}{0pt plus 5cm}subroutine mo\_\-functions::sub\_\-melt\_\-snow (
\begin{DoxyParamCaption}
\item[{REAL(wp),intent(inout)}]{ melt\_\-thick, }
\item[{REAL(wp),intent(inout)}]{ thick, }
\item[{REAL(wp),intent(inout)}]{ thick\_\-snow, }
\item[{REAL(wp),intent(inout)}]{ H\_\-abs, }
\item[{REAL(wp),intent(inout)}]{ H\_\-abs\_\-snow, }
\item[{REAL(wp),intent(inout)}]{ m, }
\item[{REAL(wp),intent(inout)}]{ m\_\-snow, }
\item[{REAL(wp),intent(inout)}]{ psi\_\-g\_\-snow}
\end{DoxyParamCaption}
)}}
\label{namespacemo__functions_ad19818302426c2848ed285986cf1430d}


Calculates how the meltwater film interacts with snow. 

Is activated when a thin snow layer (thinner then thick\_\-min) is on top of meltwater. The snow is flooded and turned into ice.

\begin{DoxyParagraph}{Revision History}
Put together by Philipp Griewank (2011-\/10-\/17) 
\end{DoxyParagraph}
\hypertarget{namespacemo__functions_a463f28035b07b28bba73b8a1100b848a}{
\index{mo\_\-functions@{mo\_\-functions}!sub\_\-melt\_\-thick@{sub\_\-melt\_\-thick}}
\index{sub\_\-melt\_\-thick@{sub\_\-melt\_\-thick}!mo_functions@{mo\_\-functions}}
\subsubsection[{sub\_\-melt\_\-thick}]{\setlength{\rightskip}{0pt plus 5cm}subroutine mo\_\-functions::sub\_\-melt\_\-thick (
\begin{DoxyParamCaption}
\item[{REAL(wp),intent(in)}]{ psi\_\-l, }
\item[{REAL(wp),intent(in)}]{ psi\_\-s, }
\item[{REAL(wp),intent(in)}]{ psi\_\-g, }
\item[{REAL(wp),intent(in)}]{ T, }
\item[{REAL(wp),intent(in)}]{ T\_\-freeze, }
\item[{REAL(wp),intent(in)}]{ T\_\-top, }
\item[{REAL(wp),intent(in)}]{ fl\_\-Q, }
\item[{REAL(wp),intent(in)}]{ thick\_\-snow, }
\item[{REAL(wp),intent(in)}]{ dt, }
\item[{REAL(wp),intent(out)}]{ melt\_\-thick, }
\item[{REAL(wp),intent(inout)}]{ thick, }
\item[{REAL(wp),intent(in)}]{ thick\_\-min}
\end{DoxyParamCaption}
)}}
\label{namespacemo__functions_a463f28035b07b28bba73b8a1100b848a}


Calculates the thickness of the meltwater film. 

If the top ice layer is being melted (T\_\-top$>$T\_\-freeze) it is assumed that a thin meltwater film appears at the top. The thickness of this film is determined by the amount of incoming heat and diffusive transport. The incoming heat is an input (fl\_\-q(1)) and the diffusive heat is (T(1)-\/T\_\-freeze)/R. See the thermodynamics section for R. The thickness of the meltlayer is determined by dividing the heat intake of the meltwater film by the amount of latent heat needed to melt the solid fraction of the top layer. If the solid fractions sinks below a given threshold (psi\_\-s\_\-top\_\-min) a different approach is used. The melt thickness is then calculated by assuming that the ice below the meltwater film has a solid fraction of psi\_\-s\_\-top\_\-min. Although the thickness can be reduced, variations of mass, salinity and enthalpy are calculated in the flushing subroutine.

\begin{DoxyParagraph}{Revision History}
Introduced by Philipp Griewank (2011-\/05-\/09) 
\end{DoxyParagraph}
\hypertarget{namespacemo__functions_a3c7420d9fae7442aeb1407179e971c35}{
\index{mo\_\-functions@{mo\_\-functions}!sub\_\-notzflux@{sub\_\-notzflux}}
\index{sub\_\-notzflux@{sub\_\-notzflux}!mo_functions@{mo\_\-functions}}
\subsubsection[{sub\_\-notzflux}]{\setlength{\rightskip}{0pt plus 5cm}subroutine mo\_\-functions::sub\_\-notzflux (
\begin{DoxyParamCaption}
\item[{REAL(wp),intent(in)}]{ time, }
\item[{REAL(wp),intent(out)}]{ fl\_\-sw, }
\item[{REAL(wp),intent(out)}]{ fl\_\-rest}
\end{DoxyParamCaption}
)}}
\label{namespacemo__functions_a3c7420d9fae7442aeb1407179e971c35}


Calculates the incoming shortwave and other fluxes according to p. 193-\/194 PhD Notz. 

Simplified version of the Untersteiner Fluxes. Returns only two fluxes as a function of time. Simplified Year, 12 months of 30 days. fl\_\-sw is set to zero for November till February Returns fluxes for day with day zero being 1. Jan. Depending on when the run starts the time should be modified when calling

\begin{DoxyParagraph}{Revision History}
Ripped from Dirk by Philipp Griewank (2011-\/02-\/13) 
\end{DoxyParagraph}
\hypertarget{namespacemo__functions_aea674291e55cedde9a5ec71e45e92dc8}{
\index{mo\_\-functions@{mo\_\-functions}!sub\_\-turb\_\-flux@{sub\_\-turb\_\-flux}}
\index{sub\_\-turb\_\-flux@{sub\_\-turb\_\-flux}!mo_functions@{mo\_\-functions}}
\subsubsection[{sub\_\-turb\_\-flux}]{\setlength{\rightskip}{0pt plus 5cm}subroutine mo\_\-functions::sub\_\-turb\_\-flux (
\begin{DoxyParamCaption}
\item[{REAL(wp),intent(in)}]{ T\_\-bottom, }
\item[{REAL(wp),intent(in)}]{ S\_\-bu\_\-bottom, }
\item[{REAL(wp),intent(in)}]{ T, }
\item[{REAL(wp),intent(inout)}]{ S\_\-abs, }
\item[{REAL(wp),intent(in)}]{ m, }
\item[{REAL(wp),intent(in)}]{ dt, }
\item[{INTEGER,intent(in)}]{ N\_\-bgc, }
\item[{REAL(wp),dimension(n\_\-bgc),intent(in),optional}]{ bgc\_\-bottom, }
\item[{REAL(wp),dimension(n\_\-bgc),intent(inout),optional}]{ bgc\_\-abs}
\end{DoxyParamCaption}
)}}
\label{namespacemo__functions_aea674291e55cedde9a5ec71e45e92dc8}


Calculates salt and tracer mixing between lowest layer and underlying water. 

Very simple turbulence assumption which mixes the lowest layer with the underlying water. Based on assumption that there is a constant amount of turbulence A. This turbulence is amplified when the lowest layer is denser then the ocean mixed layer. And also dampened when the lowest layer is less dense then the mixed layer. Assumption; turb=A$\ast$exp(B(density\_\-layer-\/density\_\-ocean)) A and B set in parameters.i A = turb\_\-A , B = turb\_\-B

\begin{DoxyParagraph}{Revision History}
Moved from grotz by Philipp Griewank (2014-\/04-\/2) 
\end{DoxyParagraph}
